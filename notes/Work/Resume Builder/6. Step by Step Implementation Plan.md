## üì¶ 0 ‚Äî Prerequisites & Tool Versions

| Tool                      | Required Version                                                      | Install Command                                              |
| ------------------------- | --------------------------------------------------------------------- | ------------------------------------------------------------ |
| **Node.js**               | 18 LTS                                                                | [https://nodejs.org](https://nodejs.org)                     |
| **pnpm**                  | ‚â•9                                                                    | `corepack enable && corepack prepare pnpm@latest --activate` |
| **Python**                | 3.11                                                                  | `pyenv install 3.11 && pyenv local 3.11`                     |
| **Supabase CLI**          | ‚â•1.143                                                                | `npm i -g supabase`                                          |
| **Railway CLI**           | ‚â•2                                                                    | `npm i -g @railway/cli`                                      |
| **Playwright (Chromium)** | installed automatically in backend Docker image; nothing local needed |                                                              |

> **OS**: macOS, Linux, WSL are all fine. Windows (plain) users should run in WSL 2.

---

## üóÇ 1 ‚Äî Repo Bootstrap (Monorepo Workspaces)

### 1.1 Create repo & workspaces

```bash
mkdir resume-platform && cd $_
git init -b main
corepack enable && corepack prepare pnpm@latest --activate
pnpm init -y
```

`package.json` ‚ûú add:

```json
{
  "private": true,
  "workspaces": ["apps/*", "packages/*"]
}
```

### 1.2 Create directory skeleton

```
root/
  apps/
    frontend/      # Next.js
    backend/       # FastAPI
  packages/
    shared/        # TS+Python shared schema (Pydantic + Zod)
  infra/
    db/            # Supabase migrations
  .env.example
  railway.json
  README.md
```

### 1.3 Git hooks & lint

```bash
pnpm add -w -D husky lint-staged prettier
npx husky install
echo '{
  "*.ts,*.tsx": "prettier --write",
  "*.py": "black"
}' > .lintstagedrc
npx husky add .husky/pre-commit "pnpm lint-staged"
```

---

## üöÇ 2 ‚Äî Railway Project & Services

### 2.1 Login & create project

```bash
railway login
railway init --project "resume-platform"
```

### 2.2 Define services (`railway.json`)

```jsonc
{
  "plugins": {},
  "services": {
    "frontend": {
      "sourceDir": "apps/frontend",
      "startCommand": "pnpm run build && pnpm run start",
      "healthcheckPath": "/api/health"
    },
    "backend": {
      "sourceDir": "apps/backend",
      "startCommand": "uvicorn main:app --host 0.0.0.0 --port $PORT",
      "healthcheckPath": "/ping"
    }
  }
}
```

### 2.3 Attach Postgres

```bash
railway add plugin postgres   # creates DB + sets PG* env vars
```

> We still use **Supabase** (remote SaaS) for Auth + Storage; Railway Postgres is unused until Post-MVP expansion.

### 2.4 Set secrets **once** (replace `‚Ä¶`)

```bash
railway variables set \
  SUPABASE_URL=‚Ä¶ \
  SUPABASE_ANON_KEY=‚Ä¶ \
  SUPABASE_SERVICE_ROLE=‚Ä¶ \
  OPENAI_API_KEY=‚Ä¶
```

---

## üèó 3 ‚Äî Backend Scaffold (FastAPI‚Äî guest-only)

### 3.1 Set up virtual env & deps

```bash
python -m venv .venv && source .venv/bin/activate
pip install fastapi uvicorn python-dotenv supabase openai pydantic python-multipart aiofiles playwright==1.43.0
playwright install chromium
```

### 3.2 Folder layout (`apps/backend`)

```
backend/
  main.py            # FastAPI instance
  api/               # route modules
  services/          # OpenAI, PDF, parsing
  models/            # Pydantic schemas
  utils/             # helpers
```

### 3.3 `main.py`

```python
from fastapi import FastAPI, Request, UploadFile, File, HTTPException
from uuid import uuid4
from services.llm import chat_completion
from services.pdf import generate_pdf

app = FastAPI()

# --- Guest-ID middleware ---------------------------------------------
@app.middleware("http")
async def ensure_guest_id(request: Request, call_next):
    guest_id = request.headers.get("X-Guest-Id")
    if not guest_id:
        guest_id = str(uuid4())
    request.state.guest_id = guest_id
    response = await call_next(request)
    response.headers["X-Guest-Id"] = guest_id   # let FE store it
    return response
# ----------------------------------------------------------------------

@app.get("/ping")
async def ping():
    return {"pong": True}

@app.post("/upload")
async def upload(
        file: UploadFile = File(...),
        request: Request = None            # guest_id available at request.state
):
    # store file, keyed by request.state.guest_id
    ...

@app.post("/chat")
async def chat(msg: str, session_id: str, request: Request = None):
    return await chat_completion(msg, session_id, request.state.guest_id)

@app.post("/generate")
async def generate(session_id: str, request: Request = None):
    ...

@app.get("/export/{session_id}")
async def export_pdf(session_id: str, request: Request = None):
    return await generate_pdf(session_id, request.state.guest_id)
```

### 3.4 Auth dependency (`services/auth.py`)

```python
from fastapi import HTTPException, Header
from supabase import create_client
import jwt, os

def get_current_user(authorization: str = Header(...)):
    token = authorization.removeprefix("Bearer ").strip()
    # Supabase JWT verification (public key from JWKs)
    ...
```

### 3.5 OpenAI wrapper (`services/llm.py`)

* Accepts `msg`, `session_id`.
* Assembles prompt from **resume\_context** + **parsed\_elements**.
* Retries malformed JSON (<3 attempts), logs to Railway.

### 3.6 Simple PDF engine (`services/pdf.py`)

* Use **react-pdf** (via Node script) **OR** Playwright (render HTML snapshot) ‚Äî we start with **react-pdf** because it deploys with zero system deps:

```python
import subprocess, json, tempfile, os

async def generate_pdf(session_id: str, guest-id):
    data = ...  # fetch resume + letter JSON
    tmp = tempfile.NamedTemporaryFile(delete=False, suffix=".json")
    tmp.write(json.dumps(data).encode()); tmp.close()
    pdf_path = tmp.name.replace(".json", ".pdf")
    subprocess.run(["node", "packages/pdf-render/index.js", tmp.name, pdf_path])
    return FileResponse(pdf_path, media_type="application/pdf")
```

---

## üé® 4 ‚Äî Frontend Scaffold (Next.js + Tailwind + Radix)

### 4.1 Create app

```bash
pnpm create next-app apps/frontend -- --tailwind --typescript --src-dir
cd apps/frontend
pnpm add @radix-ui/themes @supabase/auth-helpers-nextjs react-dropzone react-hot-toast react-markdown
```

### 4.2 Pages

```
pages/
  _app.tsx           # Radix <Theme> + SupabaseSessionProvider
  index.tsx          # redirects to /app if logged in
  signin.tsx         # Supabase Auth UI
  app/index.tsx      # main chat screen
```

### 4.3 Main screen layout (`/app`)

```tsx
<Layout>
  <Sidebar>
    <FileUploadArea onUpload={handleUpload} />
    <DownloadButton url={exportUrl} disabled={!ready} />
  </Sidebar>
  <ChatFeed messages={messages} />
  <ChatInput onSend={handleSend} disabled={loading} />
  <PreviewPane data={outputs} /> {/* read-only */}
</Layout>
```

*Styles:* Use Tailwind utility classes; rely on Radix token CSS vars for colors.

### 4.4 API hooks (`lib/api.ts`)

```ts
export const uploadFile = async (file: File) => { ... }
export const sendMessage = async (msg: string, sessionId: string) => { ... }
export const generateDocs = async (sessionId: string) => { ... }
export const exportPDF = async (sessionId: string) => { ... }
```

---

## üóÑ 5 ‚Äî Supabase Configuration

### 5.1 Enable services

* **Auth** ‚ûú Email/password; disable signup confirmation for MVP.
* **Storage** ‚ûú Bucket `resume-uploads` (public=false).

### 5.2 Run SQL migration (`infra/db/migrations/001_init.sql`)

```sql
create table users (
  id uuid primary key default uuid_generate_v4(),
  email text unique not null
);

create table sessions (
  id uuid primary key default uuid_generate_v4(),
  user_id uuid references users(id),
  status text default 'active',
  created_at timestamptz default now()
);

create table uploads (
  id uuid primary key default uuid_generate_v4(),
  session_id uuid references sessions(id),
  file_path text,
  metadata jsonb
);

create table outputs (
  id uuid primary key default uuid_generate_v4(),
  session_id uuid references sessions(id),
  data jsonb
);
```

```bash
supabase db push       # applies migration
```

---

## üîë 6 ‚Äî `.env.example`

```bash
# === Shared ===
NODE_ENV=development
FRONTEND_URL=http://localhost:3000
BACKEND_URL=http://localhost:8000

# === Supabase ===
SUPABASE_URL=
SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE=
SUPABASE_BUCKET=resume-uploads

# === Auth / Security ===
JWT_SECRET=
COOKIE_NAME=sb-auth-token

# === OpenAI ===
OPENAI_API_KEY=
OPENAI_ORG_ID=

# === Railway / Infra ===
PORT=8000               # injected in prod, used locally
```

---

## üèÉ‚Äç‚ôÄÔ∏è 7 ‚Äî Running Locally

```bash
# one tab
railway up              # spins Postgres + injects secrets

# second tab
pnpm -r dev             # runs frontend (:3000) + backend (:8000)
```

Railway will proxy services so they can talk via `localhost`.

---

## ‚úÖ 8 ‚Äî MVP Acceptance Checklist

1. **Auth**: user signs in with email/password.
2. **Upload**: doc/pdf file accepted, stored in Supabase Storage.
3. **Chat**: user asks clarifying question, GPT-4 responds.
4. **Generate**: click *Generate* ‚Üí r√©sum√© & cover-letter JSON saved.
5. **Export**: click *Download PDF* ‚Üí browser downloads combined PDF.
6. **Deploy**: pushing to `main` auto-builds & hosts both services on Railway.

---

## üî≠ 9 ‚Äî Post-MVP Roadmap (Parked)

* Replace react-pdf with Playwright for pixel-perfect print.
* Live markdown editor & diff view.
* Session history dashboard.
* Sentry, analytics, load tests.
* State-machine conversation engine & SSE streaming.
